# Carepick Backend - 병원/의사 추천 애플리케이션 

## 📄 프로젝트 소개
Carepick은 사용자에게 병원 및 의사를 추천하는 의료 정보 제공 서비스입니다. <br>
이 repository는 해당 서비스의 백엔드 서로, Spring Boot를 기반으로 병원/의사 데이터 조회, 질병 및 진료과 예측 결과 수신 등의 역할을 수행합니다.

---

## 🛠️ 기술 스택
### 📌 주요 프레임워크 및 언어
- **Spring Boot 3.4 (Kotlin)**: REST API 서버 구현
- **Spring Data JPA + Hibernate Spatial**: 병원/의사 DB 처리 및 공간 정보 질의
- **Spring WebFlux + WebClient**: Flask 서버와의 비동기 통신
- **Kotlin**: 타입 안정성과 코루틴 기반 비동기 지원
  
### 🧠 데이터 처리 및 분석
- **JTS + Hibernate Spatial**: 병원 위치 기반 거리 계산 및 공간 질의
  
### 🔌 외부 통신 및 유틸리티
- **Flask 서버 연동**: 진료과/질병 예측 결과 수신
- **Jackson (Kotlin Module)**: JSON 직렬화/역직렬화
- **Jsoup / Selenium**: 병원 데이터 수집을 위한 크롤링 로직

### 🧪 테스트 및 개발
- **Junit 5 + kotlin-test**: 단위 테스트
- **H2**: 테스트용 인메모리 데이터베이스
- **Spring Boot Devtools**: 자동 재시작 및 개발 편의성 강화
---

## ⭐ 주요 기능
1. 병원/의사 정보 관리 및 검색
   
   - 병원/의사 검색 및 상세 조회
     - 병원명, 주소, 진료과, 거리 등의 조건으로 필터링 및 정렬
     - 예: "피부과"를 진료하고 "강남" 근처 "3km" 이내 병원 검색
       
   - 위치 기반 거리 계산
     - 사용자의 위도/경도에 따라 거리 순으로 병원 정렬
     - JTS, Hibernate Spatial을 이용한 거리 질의 지원
       
   - 의사 정보 검색
     - 의사 이름 기반 검색 및 병원별 의사 목록 제공

2. 자가진단 기반 진료과/질병 예측 (Flask 연동)
   - 사용자 자연어 증상 입력 처리
   - Flask 모델 서버와 비동기 통신
   - 예측 결과 → 병원 추천 흐름 연결

3. 행정구역 및 지도 연동
   - 주소 → 위도/경도 좌표 변환 API
     - 병원 거리 계산 및 위치 기반 검색에 활용
       
   - 시도/시군구/읍면동/리 등 행정구역 필터링
     - 지역별 병원/의사 분포 탐색 지원

4. 데이터 저장 및 관리
   - 크롤링 기반 병원/의사 데이터 수집
     - 병원 웹사이트에서 병원 링크 및 의사 정보 수집 및 저장
       
   - DB 백업 및 .sql 파일 관리
     - API 호출만으로 전체 DB 백업 가능, 백업 파일 리스트 반환

5. 엔티티 목록 조회 및 필터링
   - 진료과, 질병, 행정구역 등 주요 엔티티에 대해 전체 조회 및 다중 기준 검색 지원
     
     - 질병명, 진료과, 분류명, 신체계통명 등
     - 페이징, 키워드 검색, 정렬 등 다양한 옵션 제공
     
## 👨‍💻 내 역할
본 시스템은 단독으로, 기획부터 백엔드 전체 구현까지 모든 과정을 직접 수행하였습니다.

- 프로젝트 기획 및 데이터 흐름 설계
- DB 모델링 (병원, 의사, 진료과, 질병, 행정구역 등)
- 병원/의사 크롤링 로직 및 자동 저장 API 구현
- 전체 API 문서화
- Spring Boot REST API 개발 (Kotlin)
- WebClient를 이용한 Flask 서버와의 비동기 통신 구조 설계 및 구현
- 위치 기반 병원 추천을 위한 공간 질의 및 거리 계산 처리 (Hibernate Spatial + JTS)
- 의대 순위 데이터 크롤링 및 의사 학력 점수 계산 처리

---

## 🚀 실행 방법
```bash
# 1. 프로젝트 클론
git clone https://github.com/your-id/carepick-backend.git
cd carepick-backend

# 2. application.yml 설정
# DB 정보, 외부 Flask 서버 주소 등 환경 설정

# 3. 실행
./gradlew bootRun
```

## 🔧 문제 및 해결
### ❓ 크롤링 대상 선정 및 데이터 저장 형식의 불일치 문제
#### 상황
'HiDoc' 웹사이트에서 병원 및 의사 정보를 수집할 때, HTML 구조가 페이지마다 상이하고 일부 데이터는 중복되거나 형식이 깨진 경우가 많았습니다. <br>
어떤 데이터를 신뢰하고 수집해야 하는지 기준이 모호했고, DB에 어떤 구조로 저장할지 명확하지 않았습니다. 
#### 해결
- HTML 구조를 분석하여 신뢰도 높은 정보(병원명, 주소, 진료과, 의사명 등)만 선별하여 크롤링
- 의사 정보는 병원 상세 페이지에 존재하는 경우가 많으므로, 병원 링크 → 의사 정보로 크롤링 흐름을 설계
- 수집된 데이터는 명확한 스키마(Entity 설계)를 바탕으로 병원-의사 간 관계형 구조로 저장하여 통합성 유지

### ❓ 신뢰도 있는 의사의 평가 지표 설계 문제
#### 상황
'HiDoc'의 리뷰 점수는 개인의 주관이 개입되고, 병원마다 기준이 달라 그대로 사용할 경우 신뢰도가 높다고 할 수 없다고 판단했습니다.
#### 해결
- 'Times Higher Education'에서 의대 순위와 대학교 영문명을 크롤링하고, ChatGPT를 이용해 한글명까지 저장하였습니다.
- 전국 의과대학 순위를 기준으로 의사의 학력 정보를 점수화 시켰습니다.
- 추후 경력 점수 계산 알고리즘을 추가적으로 적용하고, 학력 점수와 조합하여 **복합 신뢰도 지표**를 구성할 계획에 있습니다. 

### ❓ API 엔드포인트 명세 혼동 및 협업 효율성 문제
#### 상황
다양한 검색 조건(거리, 진료과, 키워드 등)과 필요 기능들이 많아지면서, 프론트엔드 개발자가 엔드포인트 이용에 혼란을 겪는 경우가 다수 발생하였습니다.
#### 해결
- 엔드포인트 설계를 명확하게 문서화하여 Wiki 형태로 공유하였습니다.
- 모든 API는 **페이징, 정렬, 필터링 방식**의 일관성을 유지하도록 하였습니다.
- 필요에 따라 API 응답 예시도 상세히 Wiki 페이지에 작성하였습니다.

### ❓ Flask 예측 결과의 메시지 전달 방식 설계 문제
#### 상황
자가진단 서비스를 위해, 프론트엔드에서 Flask 서버의 예측 결과를 받고자, Spring Boot 백엔드가 중간 전달자 역할을 해야 했습니다. <br>
단순 relay 이상의 구조가 필요했고, 어떤 방식으로 에러나 결과 메시지를 안정적으로 전달할지 고민이 필요했습니다. 
#### 해결
- Flask 서버의 응답 결과를 받아 **예측 결과 + 병원 추천 흐름**을 프론트에 통합 전달하도록 하였습니다.
- 질병 예측의 경우 DB에 저장된 질병 정보에서 관련 진료과 목록을 조회해 반환하도록 구현하였습니다.
- 진료과 예측의 경우 즉시 진료과 목록을 반환하도로 구현하였습니다.
- 오류 발생 시에도 예외 메시지를 일관된 형태로 전달하여 프론트에서 처리 가능하도록 설계하였습니다.
